<!DOCTYPE html>
<html>
  <head>
    <style>
      {
          {
           partial "debugprint.css" | safeCSS
        }
      }
    </style>
    <title>Quickly Connect an Argon IoT Device to QuestDB</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu0b3af3b2695bc2a8e88d59b9721b8a18_8831_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="Quickly Connect an Argon IoT Device to QuestDB" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png">David G. Simmons</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu527ca2c923a6347a00483834e2e3046d_608569_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/introduction/introduction/">Introduction</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/mad-skillz/mad-skillz/">Mad Skillz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beans/beans/">Coffee Beans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hobbies/">Hobbies</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/pranks/">Pranks</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/camunda/">Camunda</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/general/">General</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/programming/">Programming</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/dogs/">Dogs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/database/">Databases</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/category/iot/">IoT</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-hardware/">Hardware</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-software/">Software</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/work/">Work</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/devrel/">DevRel</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      
      
        
        
        
        
        






























&#34;https://davidgs.com/posts/category/iot/iot-hardware/images/rawPower.svg&#34;








        <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://davidgs.com/posts/category/iot/iot-hardware/images/rawPower.svg);'>
      </div>
      


      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/dg3.png'/>
          <h5 class="author-name">David G. Simmons</h5>
          <p>September 8, 2020</p>
        </div>

        <div class="title">
          <h1>Quickly Connect an Argon IoT Device to QuestDB</h1>
        </div>

        <div class="post-content" id="post-content">


          <p>I&rsquo;m back to <a href="https://particle.io">Particle.io</a> again. I saw that they were having a 30% off sale on the new Argon and some developer kits, so I had to jump on it, since I haven&rsquo;t gotten any new Particle hardware in years. So, what follows is a complete guide to connecting one of these kits to <a href="https://questdb.io">QuestDB</a> in order to store the data, and then building a dashboard on top of it with Grafana . Buckle up!</p>
<h2 id="the-hardware">The Hardware</h2>
<p>First, I saw a 30% discount on the Argon DevKits (curse you twitter ads!) so I bought one of the <a href="https://store.particle.io/collections/prototyping-hardware/products/air-quality-monitoring-kit-wi-fi">Argon Air Quality Monitoring Kits</a>. Y&rsquo;all know I love to monitor air quality! It&rsquo;s a really easy kit to assemble as there are no wires to solder or anything. All the sensors are connected using a Grove shield so it&rsquo;s really just plug-and-play. </p>
<h2 id="the-setup">The Setup</h2>
<p>I&rsquo;m not going to go through it all step by step because there&rsquo;s an <a href="https://docs.particle.io/quickstart/aqmk-project/">excellent tutorial</a> available already that will get you about 95% of the way there. That tutorial will get your kit all put together and all the code written to start sending your data to the Particle Cloud. I did make a few changes to the code, which I will go through. First, their tutorial uses <strong>int</strong> s for all the data coming off of the BME280 sensor. Having worked with these little things for a very long time, I know that they can deliver more accuracy, so I changed them all to <code>**floats**</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">float</span> temp, pressure, humidity;
</code></pre></div><p>That means that you have to go change the signatures for a bunch of the functions to take <code>**float**</code> rather than <code>**int**</code> so make sure you get all that done (I&rsquo;ll post the complete code, including all of my changes, at the end.</p>
<p>The other change I made was to send zero-values for sensor readings that failed to happen. The dust sensor specifically would just leave out the values if they were not rational, and so I changed it to send zeros in those cases in order to keep the database consistent and not have a bunch of null values in there. </p>
<h2 id="the-cloud-portion">The Cloud Portion</h2>
<p>When you send data to the Particle Cloud, not much happens after that. It&rsquo;s not stored anywhere, or sent anywhere until you configure someplace to send it for storage and analysis. There are a few pre-configured places to send your data, but the easiest to use is the Wbhook framework provided. This lets you construct a message and then send it to an arbitrary http end point whenever a new message arrives. </p>
<p>Of course, I did write up a complete tutorial on this, and it&rsquo;s now part of the <a href="https://docs.particle.io/tutorials/integrations/questdb/">Particle.io docs</a>. In that tutorial I was still using the <code>int</code> values from the BME280 because I didn&rsquo;t want to confuse folks and for the consistency with the other Particle docs. </p>
<h2 id="the-database-portion">The Database Portion</h2>
<p>We&rsquo;re going to need an instance of a QuestDB database, of course. This instance can&rsquo;t be running on your laptop, etc. unless you have a way to access your laptop from the open internet. (Hint: That&rsquo;s not usually a great idea.)</p>
<p>You can spin up a Digital Ocean Droplet, or a small AWS linux instance, or whatever you want in order to get yourself an accessible version of QuestDB running. </p>
<p>Once you have that, you can go to the QuestDB console at <code>http://&lt;your server address&gt;:9000/</code> and create the following table:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> ArgonAir (
  deviceID SYMBOL,
  temperature DOUBLE,
  humidity DOUBLE,
  Pressure DOUBLE,
  AirQuality SYMBOL,
  dustLpo DOUBLE,
  dustRatio DOUBLE,
  dustConc DOUBLE,
  ts <span style="color:#66d9ef">timestamp</span>
) <span style="color:#66d9ef">timestamp</span>(ts);
</code></pre></div><p>This will create the proper table structure for your device. A couple of things to note: QuestDB is much faster if you use the <code>SYMBOL</code> datatype in place of the <code>STRING</code> datatype, which is why you see that above. In addition, the <code>timestamp(ts)</code> part promotes the <code>ts</code> field to be a designated timestamp, which you will want for doing Time Series calculations on your data.</p>
<p>You can then refresh your Tables view in the console, and you should see your table laid out:</p>
<p><img src="/posts/category/iot/iot-hardware/images/Screen-Shot-2020-09-08-at-2.03.20-PM.png" alt=""></p>
<p>Once you have your table, it&rsquo;s a matter of getting data into it. You&rsquo;ll notice that, while the Particle on-device code uses fields like &ldquo;air-quality&rdquo; I have removed the hyphens from those names. The database likes that better.</p>
<p>Go to the Integrations tab of your <a href="https://console.particle.io/">Particle Console</a> and click on New Integration, and then click on Web Hook</p>
<p><img src="https://docs.particle.io/assets/images/particleNewWebhook.png" alt=""></p>
<p>Once there, we&rsquo;ll fill in the form. According to the tutorial, our event is called <code>env-vals</code>, so enter that under <strong>Event Name</strong>.</p>
<p>Under <strong>URL</strong> enter the address of your QuestDB Server <code>http:my.server.com:9000</code> or wherever your server is located.</p>
<p>Then change the <strong>Request Type</strong> to <code>GET</code>, and the <strong>Request Format</strong> to <code>Query Parameters</code></p>
<p>Now for the trickiest part: The actual query parameters. First, select <strong>Custom</strong> instead of <strong>Default</strong>, and in the first box, enter <code>Content-Type</code> in the next box on the same row, enter <code>text/plain</code> Then click on the <strong>+ Add Row</strong> button.</p>
<p>In the new row, enter <code>query</code> in the first box, and in the next box, enter:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> ArgonAir <span style="color:#66d9ef">VALUES</span>(
  <span style="color:#e6db74">&#39;{{PARTICLE_DEVICE_ID}}&#39;</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>temperature<span style="color:#960050;background-color:#1e0010">}}</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>humidity<span style="color:#960050;background-color:#1e0010">}}</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>pressure<span style="color:#960050;background-color:#1e0010">}}</span>,
  <span style="color:#e6db74">&#39;{{air-quality}}&#39;</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>dust<span style="color:#f92672">-</span>lpo<span style="color:#960050;background-color:#1e0010">}}</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>dust<span style="color:#f92672">-</span>ratio<span style="color:#960050;background-color:#1e0010">}}</span>,
  <span style="color:#960050;background-color:#1e0010">{{</span>dust<span style="color:#f92672">-</span>concentration<span style="color:#960050;background-color:#1e0010">}}</span>,
  to_timestamp(<span style="color:#e6db74">&#39;{{PARTICLE_PUBLISHED_AT}}&#39;</span>, <span style="color:#e6db74">&#39;yyyy-MM-ddTHH:mm:ss.SSSz&#39;</span>)
);
</code></pre></div><p>Some explanation of that SQL. Particle includes some things in all of the payloads, and those are in all caps. There are more, and if you want to use more of them, just make sure there are columns in your database for whatever you want to store. The payload from the device itself can either be sent as a whole, or (and this was a new trick I learned) pulled out using the {{&hellip;}} notation as individual fields.</p>
<p>Finally the PARTICLE_PUBLISHED_AT timestamp is sent, along with the formatting string, so that QuestDB will know how to properly parse the date string as a timestamp upon arrival.</p>
<p>Your integration screen should look like this:</p>
<p><img src="https://docs.particle.io/assets/images/particleQuestIntegration1.png" alt=""></p>
<p>Don&rsquo;t forget to scroll to the bottom and <em>un</em> check the <strong>Enforce SSL</strong> box, and then save your integration.</p>
<p>At this point, if your Air Quality Device is sending data to the Particle Cloud, you should begin to see readings show up in the QuestDB Console at regular intervals.</p>
<p>My database now looks like this:</p>
<p><img src="/posts/category/iot/iot-hardware/images/Screen-Shot-2020-09-08-at-2.10.21-PM-1024x181.png" alt=""></p>
<p>Pretty spiffy. But it&rsquo;s still not the nice dashboard I want.</p>
<h2 id="the-dashboard-part">The Dashboard Part</h2>
<p>QuestDB is still waiting for their Grafana plugin to be approved, but I just couldn&rsquo;t wait to build a dashboard, so I went off and (true to form) tried something entirely not supported just to see what happened. I used the Grafana Postgres plugin.</p>
<p>Guess what? It worked!</p>
<p>So, to configure the Postgres plugin for QuestDB:</p>
<p><img src="/posts/category/iot/iot-hardware/images/Screen-Shot-2020-09-08-at-2.19.59-PM.png" alt=""></p>
<p>Just fill in the defaults from the <a href="https://questdb.io/docs/guide/postgres-wire">QuestDB pgwire</a> protocol settings.</p>
<p>Once you&rsquo;ve done that, you can build out your dashboard:</p>
<p><img src="/posts/category/iot/iot-hardware/images/Screen-Shot-2020-09-08-at-2.19.33-PM.png" alt=""></p>
<p>And there you have it!</p>
<h2 id="all-the-code">All The Code</h2>
<p>As promised, here is all the code that I deployed to my Argon device:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;math.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Air_Quality_Sensor.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;Adafruit_BME280.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;SeeedOLED.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;JsonParserGeneratorRK.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define DUST_SENSOR_PIN D4
</span><span style="color:#75715e">#define SENSOR_READING_INTERVAL 30000
</span><span style="color:#75715e">#define AQS_PIN A2
</span><span style="color:#75715e"></span>
AirQualitySensor <span style="color:#a6e22e">aqSensor</span>(AQS_PIN);
Adafruit_BME280 bme;

<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> lastInterval;
<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> lowpulseoccupancy <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> last_lpo <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> duration;

<span style="color:#66d9ef">float</span> ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">float</span> concentration <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

<span style="color:#75715e">// setup() runs once, when the device is first turned on.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
  <span style="color:#75715e">// Put initialization like pinMode and begin functions here.
</span><span style="color:#75715e"></span>  Serial.begin(<span style="color:#ae81ff">9600</span>);
  delay(<span style="color:#ae81ff">1000</span>);
  Serial.println(<span style="color:#e6db74">&#34;Starting ... &#34;</span>);
  pinMode(DUST_SENSOR_PIN, INPUT);
  lastInterval <span style="color:#f92672">=</span> millis();
  <span style="color:#66d9ef">if</span> (aqSensor.init()) {
    Serial.println(<span style="color:#e6db74">&#34;Air Quality Sensor ready.&#34;</span>);
  } <span style="color:#66d9ef">else</span> {
    Serial.println(<span style="color:#e6db74">&#34;Air Quality Sensor ERROR!&#34;</span>);
  }
  <span style="color:#66d9ef">if</span> (bme.begin()) {
    Serial.println(<span style="color:#e6db74">&#34;BME280 Sensor ready.&#34;</span>);
  }  <span style="color:#66d9ef">else</span> {
    Serial.println(<span style="color:#e6db74">&#34;BME280 Sensor ERROR!&#34;</span>);
  }
  Wire.begin();
  SeeedOled.init();
  SeeedOled.clearDisplay();
  SeeedOled.setNormalDisplay();
  SeeedOled.setPageMode();
  SeeedOled.setTextXY(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Particle&#34;</span>);
  SeeedOled.setTextXY(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Air Quality&#34;</span>);
  SeeedOled.setTextXY(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Monitor&#34;</span>);
}

<span style="color:#75715e">// loop() runs over and over again, as quickly as it can execute.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
  <span style="color:#66d9ef">float</span> temp, pressure, humidity;

  <span style="color:#75715e">// The core of your code will likely live here.
</span><span style="color:#75715e"></span>  duration <span style="color:#f92672">=</span> pulseIn(DUST_SENSOR_PIN, LOW);
  lowpulseoccupancy <span style="color:#f92672">=</span> lowpulseoccupancy <span style="color:#f92672">+</span> duration;
  <span style="color:#66d9ef">if</span> ((millis() <span style="color:#f92672">-</span> lastInterval) <span style="color:#f92672">&gt;</span> SENSOR_READING_INTERVAL) {
    getDustSensorReadings();
    String quality <span style="color:#f92672">=</span> getAirQuality();
    Serial.printlnf(<span style="color:#e6db74">&#34;Air Quality: %s&#34;</span>, quality.c_str());
    getBMEValues(temp, pressure, humidity);
    Serial.printlnf(<span style="color:#e6db74">&#34;Temp: %d&#34;</span>, temp);
    Serial.printlnf(<span style="color:#e6db74">&#34;Pressure: %d&#34;</span>, pressure);
    Serial.printlnf(<span style="color:#e6db74">&#34;Humidity: %d&#34;</span>, humidity);
    updateDisplay(temp, humidity, pressure, quality);
    createEventPayload(temp, humidity, pressure, quality);
    lowpulseoccupancy <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    lastInterval <span style="color:#f92672">=</span> millis();
  }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getDustSensorReadings</span>() {
  <span style="color:#66d9ef">if</span> (lowpulseoccupancy <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
    lowpulseoccupancy <span style="color:#f92672">=</span> last_lpo;
  } <span style="color:#66d9ef">else</span> {
    last_lpo <span style="color:#f92672">=</span> lowpulseoccupancy;
  }
  ratio <span style="color:#f92672">=</span> lowpulseoccupancy <span style="color:#f92672">/</span> <span style="color:#ae81ff">10.0</span>);
  concentration <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.1</span> <span style="color:#f92672">*</span> pow(ratio, <span style="color:#ae81ff">3</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">3.8</span> <span style="color:#f92672">*</span> pow(ratio, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">520</span> <span style="color:#f92672">/</span> ratio <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.62</span>;
  Serial.printlnf(<span style="color:#e6db74">&#34;LPO: %d&#34;</span>, lowpulseoccupancy);
  Serial.printlnf(<span style="color:#e6db74">&#34;Ratio: %f%%&#34;</span>, ratio);
  Serial.printlnf(<span style="color:#e6db74">&#34;Concentration: %f pcs/L&#34;</span>, concentration);
}

String <span style="color:#a6e22e">getAirQuality</span>() {
  <span style="color:#66d9ef">int</span> quality <span style="color:#f92672">=</span> aqSensor.slope();
  String qual <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;None&#34;</span>;

  <span style="color:#66d9ef">if</span> (quality <span style="color:#f92672">==</span> AirQualitySensor<span style="color:#f92672">::</span>FORCE_SIGNAL) {
    qual <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Danger&#34;</span>;
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (quality <span style="color:#f92672">==</span> AirQualitySensor<span style="color:#f92672">::</span>HIGH_POLLUTION) {
    qual <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;High Pollution&#34;</span>;
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (quality <span style="color:#f92672">==</span> AirQualitySensor<span style="color:#f92672">::</span>LOW_POLLUTION) {
    qual <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Low Pollution&#34;</span>;
  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (quality <span style="color:#f92672">==</span> AirQualitySensor<span style="color:#f92672">::</span>FRESH_AIR) {
    qual <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fresh Air&#34;</span>;
  }
  <span style="color:#66d9ef">return</span> qual;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getBMEValues</span>(<span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span>temp, <span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span>pressure, <span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span>humidity) {
  temp <span style="color:#f92672">=</span> bme.readTemperature();
  pressure <span style="color:#f92672">=</span> (bme.readPressure() <span style="color:#f92672">/</span> <span style="color:#ae81ff">100.0F</span>);
  humidity <span style="color:#f92672">=</span> bme.readHumidity();
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateDisplay</span>(<span style="color:#66d9ef">float</span> temp, <span style="color:#66d9ef">float</span> humidity, <span style="color:#66d9ef">float</span> pressure, String airQuality) {
  SeeedOled.clearDisplay();

  SeeedOled.setTextXY(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>);
  SeeedOled.putString(airQuality);

  SeeedOled.setTextXY(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Temp: &#34;</span>);
  SeeedOled.putFloat(temp);
  SeeedOled.putString(<span style="color:#e6db74">&#34;C&#34;</span>);

  SeeedOled.setTextXY(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Humidity: &#34;</span>);
  SeeedOled.putFloat(humidity);
  SeeedOled.putString(<span style="color:#e6db74">&#34;%&#34;</span>);

  SeeedOled.setTextXY(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0</span>);
  SeeedOled.putString(<span style="color:#e6db74">&#34;Press: &#34;</span>);
  SeeedOled.putFloat(pressure);
  SeeedOled.putString(<span style="color:#e6db74">&#34; hPa&#34;</span>);

  <span style="color:#66d9ef">if</span> (concentration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
    SeeedOled.setTextXY(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>);
    SeeedOled.putString(<span style="color:#e6db74">&#34;Dust: &#34;</span>);
    SeeedOled.putNumber(concentration); <span style="color:#75715e">// Cast our float to an int to make it more compact
</span><span style="color:#75715e"></span>    SeeedOled.putString(<span style="color:#e6db74">&#34; pcs/L&#34;</span>);
  }
}

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createEventPayload</span>(<span style="color:#66d9ef">float</span> temp, <span style="color:#66d9ef">float</span> humidity, <span style="color:#66d9ef">float</span> pressure, String airQuality) {
  JsonWriterStatic<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">256</span><span style="color:#f92672">&gt;</span> jw;
  {
    JsonWriterAutoObject obj(<span style="color:#f92672">&amp;</span>jw);

    jw.insertKeyValue(<span style="color:#e6db74">&#34;temp&#34;</span>, temp <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.00</span>);
    jw.insertKeyValue(<span style="color:#e6db74">&#34;humidity&#34;</span>, humidity <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.00</span>);
    jw.insertKeyValue(<span style="color:#e6db74">&#34;pressure&#34;</span>, pressure <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.00</span>);
    jw.insertKeyValue(<span style="color:#e6db74">&#34;air-quality&#34;</span>, airQuality);

    <span style="color:#66d9ef">if</span> (lowpulseoccupancy <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-lpo&#34;</span>, lowpulseoccupancy);
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-ratio&#34;</span>, ratio);
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-concentration&#34;</span>, concentration);
    } <span style="color:#66d9ef">else</span> {
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-lpo&#34;</span>, <span style="color:#ae81ff">0.00</span>);
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-ratio&#34;</span>, <span style="color:#ae81ff">0.00</span>);
      jw.insertKeyValue(<span style="color:#e6db74">&#34;dust-concentration&#34;</span>, <span style="color:#ae81ff">0.00</span>);
    }
  }
  Particle.publish(<span style="color:#e6db74">&#34;env-vals&#34;</span>, jw.getBuffer(), PRIVATE);
}
</code></pre></div>
        
        

        
        
        
        


        


        
        
        
        
        
        
          
        
        
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/davidgs/website/edit//content/posts/category/iot/iot-hardware/quickly-connect-an-argon-iot-device-to-questdb.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/work/what-in-the-job-hopping-hell/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>What in the job hopping hell?</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/category/database/what-happens-when-you-put-your-sql-database-on-the-internet/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>What Happens When you Put Your SQL Database on the Internet</span>
          </a>
        </div>
      
    
  

  

  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#the-hardware">The Hardware</a></li>
    <li><a href="#the-setup">The Setup</a></li>
    <li><a href="#the-cloud-portion">The Cloud Portion</a></li>
    <li><a href="#the-database-portion">The Database Portion</a></li>
    <li><a href="#the-dashboard-part">The Dashboard Part</a></li>
    <li><a href="#all-the-code">All The Code</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experience</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#education">Education</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>davidgs@davidgs.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;1 (919) 534-5099</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>



    
    
<script type="text/javascript">
  var sc_project = 4739013;
  var sc_invisible = 0;
  var sc_security = "3147012e";
  var scJsHost = "https://";
  document.write("<sc" + "ript type='text/javascript' src='" +
    scJsHost +
    "statcounter.com/counter/counter.js'></" + "script>");
</script>
<noscript>
  <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
        class="statcounter" src="https://c.statcounter.com/4739013/0/3147012e/0/" alt="Web Analytics"></a></div>
</noscript>

  </body>
</html>
