<!DOCTYPE html>
<html>
  <head>
    <style>
      {
          {
           partial "debugprint.css" | safeCSS
        }
      }
    </style>
    <title>Letters to Santa – Automating Joy to the World, At Scale</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu0b3af3b2695bc2a8e88d59b9721b8a18_8831_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="Letters to Santa – Automating Joy to the World, At Scale" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png">David G. Simmons</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu527ca2c923a6347a00483834e2e3046d_608569_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/introduction/introduction/">Introduction</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/mad-skillz/mad-skillz/">Mad Skillz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beans/beans/">Coffee Beans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hobbies/">Hobbies</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/pranks/">Pranks</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/camunda/">Camunda</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/general/">General</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/programming/">Programming</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/dogs/">Dogs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/database/">Databases</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/category/iot/">IoT</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-hardware/">Hardware</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-software/">Software</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/work/">Work</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/devrel/">DevRel</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      
      
        
        
        
        
        






























&#34;https://davidgs.com/posts/category/camunda/images/santa.png&#34;








        <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://davidgs.com/posts/category/camunda/images/santa.png);'>
      </div>
      


      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/dg3.png'/>
          <h5 class="author-name">David G. Simmons</h5>
          <p>December 18, 2020</p>
        </div>

        <div class="title">
          <h1>Letters to Santa – Automating Joy to the World, At Scale</h1>
        </div>

        <div class="post-content" id="post-content">


          <p><img src="/posts/category/camunda/slack-imgs.com-2-1024x639.jpeg" alt="Santa on a water bike"></p>
<p>It’s that time of year again. The time when the world’s largest order fulfillment operation experiences its heaviest load. No, not Amazon - we’re talking about Santa Claus, Inc. - the largest logistics company in the world, with a 24-hour global delivery window at peak load.</p>
<p>This year is different, however. Earlier this year, Saint Nick clicked on an ad on his Facebook feed, one promising a digital nomad lifestyle through automating his business. Sick of the Arctic weather and the stress of traveling, the thought of sitting on a beach in Thailand - while still bringing joy to children around the world - was enticing.</p>
<p>Santa paid for the course and applied the principles of process automation, task decomposition and distribution, and integration with third-party services to his business.</p>
<p>Now he&rsquo;s kicking back on a beach on Koh Samui, while the automation brings joy to the world - at scale.</p>
<p>So this Christmas, children’s letters to Santa are routed to independent associates (their parents), who fulfill the orders using Amazon. Santa’s successful business transformation became a case study, which we’re going to share with you here.</p>
<p>Here’s how it’s done.</p>
<h2 id="the-front-end">The Front End</h2>
<p>Given that Santa&rsquo;s a modern guy, and in case he needed to supplement his retirement income with some contract front-end development work, Santa decided to do a crash course in learning to program in React.js. It seemed like the thing all the cool kids were doing, so Santa wanted to give it a shot.</p>
<p>While it was harder than he thought, thanks to a lot of hard-core googling, and a lot of copy-paste (remember kids, good developers copy, great developers paste!) he was able to come up with a site that at least looks passable, and handles the simple function of accepting a letter to Santa and submitting it to the process engine.</p>
<p>For the process engine Santa of course chose <a href="https://camunda.com">Camunda</a>!</p>
<p>Once the form was designed, all that was left to do was submit the form using some JavaScript:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">handleSubmit</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span> =&gt; {
<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>();
<span style="color:#a6e22e">setSubmitting</span>(<span style="color:#66d9ef">true</span>);
<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">checkValidity</span>()) {
  <span style="color:#75715e">// form is invalid! so we do nothing
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span>;
}
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requestOptions</span> <span style="color:#f92672">=</span> {
<span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
<span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> { <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/x-www-form-urlencoded;charset=UTF-8&#39;</span> },
<span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">formData</span>)
};
<span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;https://write-a-letter-to-santa.org:9091/santa&#39;</span>, <span style="color:#a6e22e">requestOptions</span>);

<span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Santa has been notified! You can reload the page to send another letter.&#39;</span>);
}
</code></pre></div><p>Using a simple alert to let the user know that the form was submitted was the path of least resistance, and Santa was getting lazy.</p>
<h2 id="the-process">The Process</h2>
<p>Handling a letter by just forwarding it to the parents as-is seemed a little too lazy, even for Santa, so he quickly designed a business process using <a href="https://cawemo.com">Cawemo</a> to handle the routing of the letters.</p>
<p>Here&rsquo;s what that process looks like:</p>
<p><img src="/posts/category/camunda/santa-1024x270.png" alt="Letter to Santa Business Process"></p>
<p>And here&rsquo;s the flow:</p>
<ol>
<li>A letter comes in, which starts the process.</li>
<li>The letter is analyzed using some Natural Language Processing (NLP) algorithms to extract some parts of the letter to help figure out what the writer is asking for:</li>
<li>Identify any items the writer is asking for.</li>
<li>Do some Sentiment Analysis to try to figure out how important each item is to the writer.</li>
<li>If there are no items identified, then the letter is routed to a manual process where one of the Elves can do some more investigation, and update the list.</li>
<li>Once this is done, go find some possible Amazon links for the things identified.</li>
<li>Send a letter to the parents with a copy of the original letter, the items they asked for (linked to Amazon of course) and some helpful hints as to what the writer wanted most.</li>
<li>Store the product information in a local database for analysis later.</li>
</ol>
<p>Now, before anyone tries to have Santa fined for non-compliance with GDPR, he&rsquo;s not storing any names, email addresses, or any other personal data. Santa already knows everything about you! He just stores the items asked for. So he can do some demand-gen analysis later, of course.</p>
<p>Santa wrote a pretty basic web-server in <code>Go</code> to handle the incoming letters, and submit them to the Camunda BPM processing engine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/santa&#34;</span>, <span style="color:#a6e22e">santa</span>)
<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:9091&#34;</span>, <span style="color:#66d9ef">nil</span>) <span style="color:#75715e">// set listen port
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
  <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;ListenAndServe: &#34;</span>, <span style="color:#a6e22e">err</span>)
}
</code></pre></div><p>And then a handler function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">santa</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
  <span style="color:#a6e22e">enableCors</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">w</span>)
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Method</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;GET&#34;</span> {
    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;GET Method Not Supported&#34;</span>)
    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Error</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;GET Method not supported&#34;</span>, <span style="color:#ae81ff">400</span>)
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">body</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Body</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
      panic(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(string(<span style="color:#a6e22e">body</span>))
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">t</span> <span style="color:#a6e22e">SantaData</span>
    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">body</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">t</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
      panic(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Letter</span>)
    <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">WriteHeader</span>(<span style="color:#ae81ff">200</span>)
    <span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">ClientOptions</span>{
      <span style="color:#a6e22e">EndpointUrl</span>: <span style="color:#e6db74">&#34;http://localhost:8000/engine-rest&#34;</span>,
      <span style="color:#a6e22e">ApiUser</span>: <span style="color:#e6db74">&#34;demo&#34;</span>,
      <span style="color:#a6e22e">ApiPassword</span>: <span style="color:#e6db74">&#34;demo&#34;</span>,
      <span style="color:#a6e22e">Timeout</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> ,
    })

    <span style="color:#a6e22e">processKey</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;santa&#34;</span>
    <span style="color:#a6e22e">variables</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">Variable</span>{
      <span style="color:#e6db74">&#34;name&#34;</span>: {<span style="color:#a6e22e">Value</span>: <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
      <span style="color:#e6db74">&#34;email&#34;</span>: {<span style="color:#a6e22e">Value</span>: <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">ParentEmailAddress</span>, <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
      <span style="color:#e6db74">&#34;letter&#34;</span>: {<span style="color:#a6e22e">Value</span>: <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Letter</span>, <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;string&#34;</span>},
    }
    <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">ProcessDefinition</span>.<span style="color:#a6e22e">StartInstance</span>(
      <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">QueryProcessDefinitionBy</span>{<span style="color:#a6e22e">Key</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">processKey</span>},
      <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">ReqStartInstance</span>{<span style="color:#a6e22e">Variables</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">variables</span>},
    )
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
      <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Error starting process: %sn&#34;</span>, <span style="color:#a6e22e">err</span>)
      <span style="color:#66d9ef">return</span>
    }
  }
}
</code></pre></div><p>He did have to enable CORS to allow the cross-origin posting of data. That&rsquo;s rather a key point in all of this, since the server here runs on a different port than the server that handles posting the letters.</p>
<p>After that, a bit of magic with the <a href="https://github.com/citilinkru/camunda-client-go">Camunda Go Client</a> and the letter is submitted to the Camunda BPM Process Engine.</p>
<h2 id="natural-language-processing">Natural Language Processing?</h2>
<p>Yes, it&rsquo;s a form of Artificial Intelligence (AI) that allows you to break up written text and identify parts of it based on certain criteria. Done right, it can be very accurate.</p>
<p>So let&rsquo;s take a sample letter:</p>
<blockquote>
<p>Dear Santa,</p>
<p>My name is Leon and I&rsquo;m 36 years old (yeah, I still believe in Santa 😇)</p>
<p>This year I&rsquo;ve been the goodest kid ever, so I kinda deserve a big present&hellip;</p>
<p>I was thinking about a nice LEGO box like the skyline kit or the New York City one. If that&rsquo;s not an option, I&rsquo;d settle for some good chocolate too!</p>
<p>Thank you,
Leon</p>
</blockquote>
<p>Now you and I can easily pick out the <code>items</code> in that letter that would be gifts, but it turns out that doing that is harder than it seems.</p>
<p>When we run that through our NLP processor we get:</p>
<pre>This year I've been the goodest kid ever, so I kinda deserve a big present...
Sentiment: 0.300000, positive Item: name Type: OTHER
Sentence: I was thinking about a nice LEGO box like the skyline kit or the New York City one.
Sentiment: 0.200000, positive Item: LEGO box Type: OTHER
Item: skyline kit Type: OTHER
Sentence: If that's not an option, I'd settle for some good chocolate too!
Sentiment: 0.700000, positive Item: option Type: OTHER
Item: chocolate Type: OTHER
Sentence: Thank you,
Leon
Sentiment: 0.800000, positive
</pre>
<p>Hmmm &hellip; Not great.</p>
<p>If Leon had written Santa a more specific letter, we could have gotten some better results for him:</p>
<blockquote>
<p>Dear Santa,</p>
<p>My name is Leon and I&rsquo;m 36 years old (yeah, I still believe in Santa 😇)</p>
<p>This year I&rsquo;ve been the goodest kid ever, so I kinda deserve a big present&hellip;</p>
<p>I was thinking about a nice Lego skyline kit or the Lego New York City Skyline Kit.</p>
<p>If that&rsquo;s not an option, I&rsquo;d settle for some good Belgian Chocolate too!</p>
<p>Thank you,
Leon</p>
</blockquote>
<p>When we process that letter, we get better results:</p>
<pre>Letter is 4 sentences long.
Sentence: Dear Santa, My name is Leon and I'm 36 years old (yeah, I still believe in Santa 😇) This year I've been the goodest kid ever, so I kinda deserve a big present...
Sentiment: 0.500000, positive Item: name Type: OTHER
Item: Santa Type: OTHER
Sentence: I was thinking about a nice Lego skyline kit or the Lego New York City Skyline Kit.
Sentiment: 0.000000, positive Item: skyline kit Type: OTHER
Item: Lego Type: ORGANIZATION
Item: Skyline Kit Type: CONSUMER_GOOD
Sentence: If that's not an option, I'd settle for some good Belgian Chocolate too!
Sentiment: 0.400000, positive Item: option Type: OTHER
Item: Belgian Chocolate Type: CONSUMER_GOOD
Sentence: Thank you, Leon
Sentiment: 0.800000, positive
</pre>
<p>You&rsquo;ll notice that now we have identified some <code>CONSUMER_GOODS</code> in the letter, which are <em>much</em> easier to find.</p>
<p>So let&rsquo;s see how Santa went about finding links.</p>
<h2 id="what-about-if-there-are-no-consumer_goods">What about if there are no CONSUMER_GOODS?</h2>
<p>That&rsquo;s where the magic of manual processes and forms comes in, of course. We have an exclusive gateway that checks to see if any <code>CONSUMER_GOODS</code> have been identified. If not, then it would be harder for the Amazon-search process to find anything meaningful.</p>
<p>This part of the process is where the Elves come into play. They didn&rsquo;t all lose their jobs once the whole operation was automated! But they <em>were</em> able to join the &ldquo;Work From Home&rdquo; movement, so now they do their jobs from wherever they want! (Look for elves in your neighborhood!)</p>
<p>Let&rsquo;s say Leon had written a letter that just said &ldquo;I want world peace. And I&rsquo;d love harmony&rdquo;. While those are lofty ideals, they aren&rsquo;t really things that can be ordered from Amazon (at least not yet).</p>
<p>Here&rsquo;s the form the Elves get when a letter gets routed to them for intervention:
<img src="/posts/category/camunda/form1-1024x257.png" alt="When the form arrives"></p>
<p>And then after the Elves have given it some thought, checked the Naughty/Nice list, they can update the items:
<img src="/posts/category/camunda/form2-1024x250.png" alt="Updated Items form"></p>
<p>The form is then routed back into the process.</p>
<p>There is a bit of work to do in building the form though. First thing is to build the form according to the <a href="https://docs.camunda.org/manual/7.5/reference/embedded-forms/javascript/lifecycle/">docs</a>. Since Santa put everything into a JSON object when the letter was parsed, he had a bit more work to do though.</p>
<p>Edit any Gifts to make them easier to search for</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">variableManager</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">camForm</span>.<span style="color:#a6e22e">variableManager</span>;

  <span style="color:#a6e22e">camForm</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;form-loaded&#39;</span>, <span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// fetch the variable &#39;gifts&#39;
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">fetchVariable</span>(<span style="color:#e6db74">&#39;gifts&#39;</span>);
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variableValue</span>(<span style="color:#e6db74">&#39;gifts&#39;</span>))
  });

  <span style="color:#a6e22e">camForm</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;variables-fetched&#39;</span>, <span style="color:#66d9ef">function</span>() {
    <span style="color:#75715e">// value has been fetched from the backend
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variableValue</span>(<span style="color:#e6db74">&#39;gifts&#39;</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">frm</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;santa-form&#39;</span>)
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;<span style="color:#75715e">// will be the number of gifts.
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// it&#39;s an array of Json so we have to parse it.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variables</span>.<span style="color:#a6e22e">gifts</span>.<span style="color:#a6e22e">originalValue</span>);
    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">length</span>;<span style="color:#a6e22e">x</span><span style="color:#f92672">++</span>){
      <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">y</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">y</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">gift</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">y</span><span style="color:#f92672">++</span>){
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">textfield</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;INPUT&#34;</span>);
        <span style="color:#a6e22e">textfield</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>;
        <span style="color:#75715e">// set the ID so we know where the gift goes back in the JSON array
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">textfield</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gift-&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">y</span>
        <span style="color:#a6e22e">textfield</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">m</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">gift</span>[<span style="color:#a6e22e">y</span>];
        <span style="color:#a6e22e">textfield</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;form-control&#34;</span>);
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">label</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;Label&#34;</span>);
        <span style="color:#a6e22e">label</span>.<span style="color:#a6e22e">htmlFor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">textfield</span>.<span style="color:#a6e22e">id</span>;
        <span style="color:#a6e22e">g</span><span style="color:#f92672">++</span>
      }
    }
  });

  <span style="color:#a6e22e">camForm</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;submit&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">evt</span>) {
    <span style="color:#75715e">// get the form
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">frm</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;santa-form&#39;</span>)
    <span style="color:#75715e">// parse the original JSON
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">m</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variables</span>.<span style="color:#a6e22e">gifts</span>.<span style="color:#a6e22e">originalValue</span>);
    <span style="color:#75715e">// get all the inputs
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">inputs</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">forms</span>[<span style="color:#e6db74">&#34;form&#34;</span>].<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#e6db74">&#34;input&#34;</span>);
    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">x</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">inputs</span>.<span style="color:#a6e22e">length</span>;<span style="color:#a6e22e">x</span><span style="color:#f92672">++</span>){
      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputs</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;-&#34;</span>);
      <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>){
        <span style="color:#a6e22e">m</span>[parseInt(<span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">1</span>])].<span style="color:#a6e22e">gift</span>[parseInt(<span style="color:#a6e22e">e</span>[<span style="color:#ae81ff">2</span>])] <span style="color:#f92672">=</span> <span style="color:#a6e22e">inputs</span>[<span style="color:#a6e22e">x</span>].<span style="color:#a6e22e">value</span>
      }
    }
  <span style="color:#75715e">// re-stringify the updated JSON
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#66d9ef">final</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">m</span>)
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">backendValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variable</span>(<span style="color:#e6db74">&#39;gifts&#39;</span>).<span style="color:#a6e22e">value</span>;
  <span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">final</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">backendValue</span>) {
    <span style="color:#75715e">// prevent submit if value of form field was not changed
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">evt</span>.<span style="color:#a6e22e">submitPrevented</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#75715e">// set value in variable manager so that it can be sent to backend
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">variableManager</span>.<span style="color:#a6e22e">variableValue</span>(<span style="color:#e6db74">&#39;gifts&#39;</span>, <span style="color:#66d9ef">final</span>);
  }
</code></pre></div><p>Santa had to create all the form elements on-the-fly, and then read them back into the instance variable at the end.</p>
<p>Now, here&rsquo;s the tricky bit: If you&rsquo;re uploading a form along with your diagram, you can&rsquo;t use the easy interface provided by the Modeler. You have to use a manual process. Santa, being an old-school command-line guy, used <code>curl</code>:</p>
<pre>curl -w “n” — cookie cookie.txt
-H “Accept: application/json”
-F "deployment-name=santa"
-F "enable-duplicate-filtering=false"
-F "deploy-changed-only=false"
-F "santa.bpmn=@/Users/santa/Downloads/santa.bpmn"
-F "ManualLetter.html=@/Users/santa/github.com/letter-to-santa/src/ManualLetter.html"
http://santa-server.com:8080/engine-rest/deployment/create
</pre>
<p>That uploads the BPMN file and the Form to the Camunda BPM Server, and then when the manual process is called, the form shows up!</p>
<h2 id="finding-links">Finding Links</h2>
<p>Being Santa, and having an entire <em>year</em> to plan for this, you would have thought Santa could have been better prepared, but, well, the retirement decision was sort of last-minute, and the beach in Thailand was sooo nice, he sort of forgot a few details.</p>
<p>The main detail he forgot was to create an Amazon Seller Account, which would have given him access to the product search API. With that, he could have done a much better job of searching for products, looking at the results, etc.</p>
<p>This was not the case, alas. But thankfully one of Santa&rsquo;s smarter elves stepped up at the last minute and told him to just use an Amazon search URL. Next year, Santa will be more prepared for this.</p>
<h2 id="sending-the-email">Sending the Email</h2>
<p>Since Santa didn&rsquo;t really want to do, well, much of anything, even the email portion was automated.</p>
<p>He took all the information gathered in the previous steps, and pulled it all together into a nice email to the Parents:</p>
<blockquote>
<p>Seasons Greetings!</p>
<p>Guess what? Leon has written me a letter asking for a few things. As I&rsquo;ve now retired to a beach in Thailand, I thought maybe you&rsquo;d like to know what Lean asked for. Here&rsquo;s the letter:</p>
<blockquote>
<p>&ldquo;Dear Santa,</p>
<p>My name is Leon and I&rsquo;m 36 years old (yeah, I still believe in Santa 😇)</p>
<p>This year I&rsquo;ve been the goodest kid ever, so I kinda deserve a big present&hellip;</p>
<p>I was thinking about a nice Lego skyline kit or the Lego New York City Skyline Kit.</p>
<p>If that&rsquo;s not an option, I&rsquo;d settle for some good Belgian Chocolate too!</p>
<p>Thank you,
Leon&rdquo;</p>
</blockquote>
<p>I&rsquo;ve taken the liberty of figuring out which things they want most, and provided you with a list so that you can just purchase these items directly. Don&rsquo;t worry, the Elves are not out of work! They&rsquo;re working from home to monitor all the processes. And no, they are not available for purchase.</p>
<p>So, that list:</p>
<ul>
<li>skyline kit ⁉️</li>
<li>Lego Skyline Kit ⁉️</li>
<li>Belgian Chocolate ❗️</li>
</ul>
<p>In case you&rsquo;re wondering, since I&rsquo;m retired, I&rsquo;m also lazy. So I&rsquo;ve used some Artificial Intelligence (which really isn&rsquo;t all that intelligent) to sort of &lsquo;rate&rsquo; what they asked for. I <em>could</em> have ordered the list, but as I just told you, I&rsquo;m retired, and lazy. Here&rsquo;s the rating system:</p>
<ul>
<li>⚠️: meh.</li>
<li>⁉️: Ok, I guess.</li>
<li>❗: Now we&rsquo;re talkin!</li>
<li>‼️: Oh please! Oh Please! Oh please!</li>
</ul>
<p>All the best from me and Mrs. Claus</p>
<p>&ndash;
PS: Please don&rsquo;t write back to this email address. I&rsquo;m retired!</p>
<p><a href="https://write-a-letter-to-santa.org">Write your own letter!</a></p>
</blockquote>
<p>Santa was now done. And he didn&rsquo;t have to lift a finger!</p>
<h2 id="how-did-he-do-it-all">How did he do it all?</h2>
<p>It did take writing some code, but Santa was able to use the Camunda Golang client library to handle everything.</p>
<p>As we saw, once the letter was submitted, the web server created a new task in Camunda and submitted it, along with all the process variables it needed to keep track of (to start with, just the <code>name</code>, <code>email address</code> and the <code>letter</code> itself). We&rsquo;ve already seen how that was done.</p>
<p>But once that was submitted as a task, how was that task handled?</p>
<h2 id="handling-a-task">Handling a task</h2>
<p>This is the technical bit. In that same Go process that handles the incoming letters (though it could have been in a completely separate process), we listen for new tasks on the <code>santa</code> queue. Specifically, we first listen for <code>nlp-extraction</code> tasks.</p>
<p>First, we have to create a client for the Camunda BPM engine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">NewClient</span>(<span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">ClientOptions</span>{
    <span style="color:#a6e22e">EndpointUrl</span>: <span style="color:#e6db74">&#34;http://hostname:8080/engine-rest&#34;</span>,
    <span style="color:#75715e">// ApiUser: &#34;demo&#34;,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ApiPassword: &#34;demo&#34;,
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Timeout</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
  })
  <span style="color:#a6e22e">logger</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
}
</code></pre></div><p>Once we have the client, we can begin to create some processes that watch the various task queues. So for the NLP queue:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">proc</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">NewProcessor</span>(<span style="color:#a6e22e">client</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">ProcessorOptions</span>{
    <span style="color:#a6e22e">WorkerId</span>: <span style="color:#e6db74">&#34;nlpProcessor&#34;</span>,
    <span style="color:#a6e22e">LockDuration</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
    <span style="color:#a6e22e">MaxTasks</span>: <span style="color:#ae81ff">10</span>,
    <span style="color:#a6e22e">MaxParallelTaskPerHandler</span>: <span style="color:#ae81ff">100</span>,
    <span style="color:#a6e22e">LongPollingTimeout</span>: <span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>,
  }, <span style="color:#a6e22e">logger</span>)
  <span style="color:#75715e">// NLP Handler
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">proc</span>.<span style="color:#a6e22e">AddHandler</span>(
    <span style="color:#f92672">&amp;</span>[]<span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">QueryFetchAndLockTopic</span>{
    {<span style="color:#a6e22e">TopicName</span>: <span style="color:#e6db74">&#34;nlp-extraction&#34;</span>},
  },
  <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">Context</span>) <span style="color:#66d9ef">error</span> {
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Running task %s. WorkerId: %s. TopicName: %sn&#34;</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">WorkerId</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">TopicName</span>)
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sentRes</span> <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">Variable</span>
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
    <span style="color:#a6e22e">varb</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">Variables</span>
    <span style="color:#a6e22e">text</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%v&#34;</span>, <span style="color:#a6e22e">varb</span>[<span style="color:#e6db74">&#34;letter&#34;</span>].<span style="color:#a6e22e">Value</span>)
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">text</span>)
    <span style="color:#a6e22e">sentRes</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">analyze</span>(<span style="color:#a6e22e">text</span>) <span style="color:#75715e">// &lt;-- **this is the important bit
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
      <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">vars</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">Variable</span>)
    <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;status&#34;</span>] = <span style="color:#a6e22e">camundaclientgo</span>.<span style="color:#a6e22e">Variable</span>{<span style="color:#a6e22e">Value</span>: <span style="color:#e6db74">&#34;true&#34;</span>, <span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;boolean&#34;</span>}
    <span style="color:#a6e22e">vars</span>[<span style="color:#e6db74">&#34;gifts&#34;</span>] = <span style="color:#a6e22e">sentRes</span>
    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Complete</span>(<span style="color:#a6e22e">processor</span>.<span style="color:#a6e22e">QueryComplete</span>{
      <span style="color:#a6e22e">Variables</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">vars</span>,
    })
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
      <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Error set complete task %s: %sn&#34;</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#a6e22e">err</span>)
    }
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Task %s completedn&#34;</span>, <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">Task</span>.<span style="color:#a6e22e">Id</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
  },
  )
</code></pre></div><p>This process creation process is also provided by the <a href="https://github.com/citilinkru/camunda-client-go/processor">Go Client</a>.</p>
<p>The process is created, using the <code>client</code> created previously, and telling the process what tasks to listen for, how long to lock the task (so no one else tries to claim and process it) and then what to docs once the task is claimed. A Camunda Client <code>Variable</code> object is created, and then the <code>analyze()</code> function is called.</p>
<p>The analysis function returns the <code>Variable</code> which has been filled out with all the parts identified. Those are all stored in a JSON object (represented by a <code>struct</code> in Go)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Gift</span> []<span style="color:#66d9ef">struct</span> {
<span style="color:#a6e22e">Gifts</span> []<span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;gift&#34;`</span>
<span style="color:#a6e22e">Types</span> []<span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;type&#34;`</span>
<span style="color:#a6e22e">Sentiments</span> []<span style="color:#66d9ef">int</span> <span style="color:#e6db74">`json:&#34;sentiment&#34;`</span>
<span style="color:#a6e22e">Amazon</span> []<span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;amazon&#34;`</span>
}
</code></pre></div><p>After the <code>analyze</code> function completes, the <code>Gifts</code>, <code>Types</code> and <code>Sentiments</code> are all filled out, but the <code>Amazon</code> portion is empty because we haven&rsquo;t done that yet.</p>
<p>Since we&rsquo;ve completed the analysis of the letter, we take all the results, package them up into some new variables, and put everything back into the Camunda BPM engine.</p>
<p>Of course, the next step is to create a similar process to watch for tasks on the <code>amazon-search</code> queue. The process is really identical to the previous one, except that it listens for different task identifiers, and calls a different method to execute on the instance variables.</p>
<p>Once the <code>amazon-search</code> task is completed (and the <code>Amazon</code> portion of the data structure is filled in for each <code>Gift</code> idea), the whole thing is returned to Camunda BPM and the task is marked as completed.</p>
<p>Which moves it on to the <code>email</code> portion.</p>
<p>Again, a <code>processor</code> is defined to listen for <code>email</code> tasks, claim them, and then compose and send the email to the recipient. Once this is done, the task is marked as completed, and returned.</p>
<p>Finally, we have a task that stores all the <code>Gifts</code> in a database so that Santa can see what sorts of gifts people asked for this year. He may be retired, but still needs to keep a finger on the pulse of what kids want!</p>
<h2 id="work-flow-completion">Work Flow Completion</h2>
<p>This entire workflow is extremely efficient. It generally completes in a few seconds at most. It&rsquo;s so fast, in fact, that Santa can&rsquo;t even see any processes sitting around in Cockpit! Unless there&rsquo;s a problem. Which there won&rsquo;t be, because Santa doesn&rsquo;t want to be disturbed.</p>
<h2 id="areas-for-improvement">Areas for improvement</h2>
<p>Of course the NLP part could be improved substantially. Santa simply used the free-tier of Google&rsquo;s Natural Language Processing engine, with zero adjustments, and took the results without any further analysis. (Need I remind you of Santa&rsquo;s laziness at this point?).</p>
<p>Further, the Amazon search portion could be <em>much</em> better with an actual Amazon Reseller account. Maybe next year.</p>
<p>If you can think of other areas for improvement &ndash; and there must be a lot! &ndash; please feel free to reach out to <a href="mailto:david.simmons@camunda.com">David G. Simmons</a>, Principal Developer Advocate at Camunda who was responsible for helping Santa get this entire process set up.</p>
<p><a href="https://write-a-letter-to-santa.org">Write your own letter!</a></p>
<p><img src="/posts/category/camunda/santa.png" alt="Write your own letter"></p>

        
        

        
        
        
        


        


        
        
        
        
        
        
          
        
        
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/davidgs/website/edit//content/posts/category/camunda/letters-to-santa-automating-joy-to-the-world-at-scale.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
    
      
        
        
        <div class="col-md-12 next-article">
          <a href="/posts/work/what-in-the-job-hopping-hell/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>What in the job hopping hell?</span>
          </a>
        </div>
      
    
  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#the-front-end">The Front End</a></li>
    <li><a href="#the-process">The Process</a></li>
    <li><a href="#natural-language-processing">Natural Language Processing?</a></li>
    <li><a href="#what-about-if-there-are-no-consumer_goods">What about if there are no CONSUMER_GOODS?</a></li>
    <li><a href="#finding-links">Finding Links</a></li>
    <li><a href="#sending-the-email">Sending the Email</a></li>
    <li><a href="#how-did-he-do-it-all">How did he do it all?</a></li>
    <li><a href="#handling-a-task">Handling a task</a></li>
    <li><a href="#work-flow-completion">Work Flow Completion</a></li>
    <li><a href="#areas-for-improvement">Areas for improvement</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experience</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#education">Education</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>davidgs@davidgs.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;1 (919) 534-5099</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>



    
    
<script type="text/javascript">
  var sc_project = 4739013;
  var sc_invisible = 0;
  var sc_security = "3147012e";
  var scJsHost = "https://";
  document.write("<sc" + "ript type='text/javascript' src='" +
    scJsHost +
    "statcounter.com/counter/counter.js'></" + "script>");
</script>
<noscript>
  <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
        class="statcounter" src="https://c.statcounter.com/4739013/0/3147012e/0/" alt="Web Analytics"></a></div>
</noscript>

  </body>
</html>
