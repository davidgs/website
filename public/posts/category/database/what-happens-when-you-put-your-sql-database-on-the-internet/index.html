<!DOCTYPE html>
<html>
  <head>
    <style>
      {
          {
           partial "debugprint.css" | safeCSS
        }
      }
    </style>
    <title>What Happens When you Put Your SQL Database on the Internet</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu0b3af3b2695bc2a8e88d59b9721b8a18_8831_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="What Happens When you Put Your SQL Database on the Internet" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png">David G. Simmons</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu527ca2c923a6347a00483834e2e3046d_608569_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/introduction/introduction/">Introduction</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/mad-skillz/mad-skillz/">Mad Skillz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beans/beans/">Coffee Beans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hobbies/">Hobbies</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/pranks/">Pranks</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/camunda/">Camunda</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/general/">General</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/programming/">Programming</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/dogs/">Dogs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/database/">Databases</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/category/iot/">IoT</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-hardware/">Hardware</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-software/">Software</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/work/">Work</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/devrel/">DevRel</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      
      
        
        
        
        
        






























&#34;https://davidgs.com/posts/category/database/images/join.png&#34;








        <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://davidgs.com/posts/category/database/images/join.png);'>
      </div>
      


      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/dg3.png'/>
          <h5 class="author-name">David G. Simmons</h5>
          <p>June 25, 2020</p>
        </div>

        <div class="title">
          <h1>What Happens When you Put Your SQL Database on the Internet</h1>
        </div>

        <div class="post-content" id="post-content">


          <p>And then we posted it to Hacker News.</p>
<p>If you listen to, well, pretty much anyone rational, they will tell you in no uncertain terms that the last thing you ever want to do is put your SQL Database on the internet. And even if you&rsquo;re crazy enough to do that, you certainly would never go post the address to it on a place like Hacker News. Not unless you were a masochist anyway.</p>
<p>We did it though, and we&rsquo;re not even a little bit sorry about it.</p>
<h2 id="the-idea">The Idea</h2>
<p><a href="https://questdb.io/">QuestDB</a> has built what we think is the fastest Open Source SQL Database in existence. We really do. And we&rsquo;re pretty proud of it, in fact. So much so that we wanted to give anyone that wanted the opportunity a chance to take it for a spin. With real data. Doing real queries. Almost anyone can pull together a demo that performs great under just the right conditions, with all the parameters tightly controlled.</p>
<p>But what happens if you unleash the hordes on it? What happens if you let anyone run queries against it? Well, we can tell you, now.</p>
<h2 id="what-it-is">What It Is</h2>
<p>First off, it&rsquo;s a SQL-based Time Series database, built from the ground up for performance. It&rsquo;s built to store and query very large amounts of data very quickly.</p>
<p>We deployed it on an AWS <code>c5.metal</code> server in the London, UK datacenter (sorry all you North Americans, there&rsquo;s some built-in latency due to the laws of physics). It was configured with 196GB of RAM, but we were only using 40GB at peak usage. The <code>c5.metal</code> instance provides 2 24-core CPUs (48 cores), but we only used one of them (24 cores) on 23 threads. We really weren&rsquo;t using anywhere <em>close</em> to the full potential of this AWS instance. That didn&rsquo;t appear to matter at all.</p>
<p>The data is stored on an AWS EBS volume that provides SSD access to the data. It&rsquo;s not all in memory.</p>
<p>The data is the entire <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">NYC Taxi Database</a> plus associated weather data. It amounts to 1.6 billion records, weighing in at about 350GB of data. That&rsquo;s a lot. And it&rsquo;s too much to store in-memory. It&rsquo;s too much to cache.</p>
<p>We provided some clickable queries to get people started (none of the results were cached or pre-calculated) but we essentially didn&rsquo;t restrict the kinds of queries that users could run. We wanted to see, and let users see, how well this performed on whatever queries they threw at it.</p>
<p>It was not disappointing!</p>
<h2 id="the-hacker-news-post">The Hacker News Post</h2>
<blockquote>
<p>A few weeks ago, we wrote about how we implemented SIMD instructions to aggregate a billion rows in milliseconds [1] thanks in great part to Agner Fog’s VCL library [2]. Although the initial scope was limited to table-wide aggregates into a unique scalar value, this was a first step towards very promising results on more complex aggregations. With the latest release of QuestDB, we are extending this level of performance to key-based aggregations.</p>
<p>To do this, we implemented Google’s fast hash table aka “Swisstable” [3] which can be found in the Abseil library [4]. In all modesty, we also found room to slightly accelerate it for our use case. Our version of Swisstable is dubbed “rosti”, after the traditional Swiss dish [5]. There were also a number of improvements thanks to techniques suggested by the community such as prefetch (which interestingly turned out to have no effect in the map code itself) [6]. Besides C++, we used our very own queue system written in Java to parallelise the execution [7].</p>
<p>The results are remarkable: millisecond latency on keyed aggregations that span over billions of rows.</p>
<p>We thought it could be a good occasion to show our progress by making this latest release available to try online with a pre-loaded dataset. It runs on an AWS instance using 23 threads. The data is stored on disk and includes a 1.6billion row NYC taxi dataset, 10 years of weather data with around 30-minute resolution and weekly gas prices over the last decade. The instance is located in London, so folks outside of Europe may experience different network latencies. The server-side time is reported as “Execute”.</p>
<p>We provide sample queries to get started, but you are encouraged to modify them. However, please be aware that not every type of query is fast yet. Some are still running under an old single-threaded model. If you find one of these, you’ll know: it will take minutes instead of milliseconds. But bear with us, this is just a matter of time before we make these instantaneous as well. Next in our crosshairs is time-bucket aggregations using the SAMPLE BY clause.</p>
<p>If you are interested in checking out how we did this, our code is available open-source [8]. We look forward to receiving your feedback on our work so far. Even better, we would love to hear more ideas to further improve performance. Even after decades in high performance computing, we are still learning something new every day.</p>
<p>[1] <a href="https://questdb.io/blog/2020/04/02/using-simd-to-aggregate-b">https://questdb.io/blog/2020/04/02/using-simd-to-aggregate-b</a>&hellip;</p>
<p>[2] <a href="https://www.agner.org/optimize/vectorclass.pdf">https://www.agner.org/optimize/vectorclass.pdf</a></p>
<p>[3] <a href="https://www.youtube.com/watch?v=ncHmEUmJZf4">https://www.youtube.com/watch?v=ncHmEUmJZf4</a></p>
<p>[4] <a href="https://github.com/abseil/abseil-cpp">https://github.com/abseil/abseil-cpp</a></p>
<p>[5] <a href="https://github.com/questdb/questdb/blob/master/core/src/main">https://github.com/questdb/questdb/blob/master/core/src/main</a>&hellip;</p>
<p>[6] <a href="https://github.com/questdb/questdb/blob/master/core/src/main">https://github.com/questdb/questdb/blob/master/core/src/main</a>&hellip;</p>
<p>[7] <a href="https://questdb.io/blog/2020/03/15/interthread">https://questdb.io/blog/2020/03/15/interthread</a></p>
<p>[8] <a href="https://github.com/questdb/questdb">https://github.com/questdb/questdb</a></p>
</blockquote>
<p>And then we posted the link to the live database.</p>
<p>And sat back.</p>
<p>And watched the incoming traffic.</p>
<p>And tried not to panic.</p>
<h2 id="what-happened">What Happened</h2>
<p>First off, we made the front page of Hacker News. Then we stayed there. For <em>hours</em>.</p>
<p>We saw a lot of traffic. I mean a <em>lot</em> of traffic. Somewhere over 20,000 unique IP addresses.</p>
<p>Excluding simple <code>show</code> queries, we saw 17,128 SQL queries with 2,485 syntax errors in the queries. We sent back almost 40GB of data in response to the queries. The response times were phenomenal. Sub-second responses to nearly all of the queries.</p>
<p>Someone in the HN comments suggested that column stores are bad at joins, which led to someone coming in and trying to join the table to itself. Ordinarily, this would be a stunningly bad decision.</p>
<p>The result was &hellip; not what they were expecting:</p>
<p><img src="/posts/category/database/images/join.png" alt=""></p>
<p>Yeah, that&rsquo;s 2,671,914,914,060,072,000 rows. In 69ms (including network transfer time). That&rsquo;s a lot of results in a very short amount of time. Definitely not what they were expecting.</p>
<p>We saw only a couple of bad actors try something cute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#f92672">-</span><span style="color:#ae81ff">23</span>T20:<span style="color:#ae81ff">59</span>:<span style="color:#ae81ff">02</span>.<span style="color:#ae81ff">958813</span>Z I i.q.<span style="color:#66d9ef">c</span>.h.p.JsonQueryProcessorState [<span style="color:#ae81ff">8536</span>] <span style="color:#66d9ef">exec</span> [q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;drop table trips&#39;</span>]
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span>T02:<span style="color:#ae81ff">56</span>:<span style="color:#ae81ff">55</span>.<span style="color:#ae81ff">782072</span>Z I i.q.<span style="color:#66d9ef">c</span>.h.p.JsonQueryProcessorState [<span style="color:#ae81ff">6318</span>] <span style="color:#66d9ef">exec</span> [q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;drop *&#39;</span>]
</code></pre></div><p>But those didn&rsquo;t work. We may be crazy, but we&rsquo;re not naive.</p>
<h2 id="what-we-learned">What we learned</h2>
<p>It turns out that when you do something like this, you learn a lot. You learn about your strengths and your weaknesses. And you learn about what users want to do with your product as well as what they will do to try to break it.</p>
<p>Joining the table to itself was one such lesson. But we also saw a lot of folks use a <code>where</code> clause, which caused fairly slow results. We were not entirely surprised by this result, as we are aware that we have not done the optimizations on that path to yield the fast results we want. But it was a great insight into how often it is used, and how people use it.</p>
<p>We saw a number of people use the <code>group by</code> clause as well, and then be surprised that it didn&rsquo;t work. We probably should have warned people about that. In short, <code>group by</code> is automatically inferred, so it&rsquo;s not needed. But since it&rsquo;s not implemented at all, it causes an error. So we&rsquo;re looking at ways to handle that.</p>
<p>We are taking all these lessons to heart, and making plans to address everything we saw in upcoming releases.</p>
<h2 id="conclusions">Conclusions</h2>
<p>It seems that the vast majority of the people that tried the demo were very impressed with it. The speed is truly breathtaking.</p>
<p>Here are just a few of the comments we got in the thread:</p>
<blockquote>
<p>I abused LEFT JOIN to create a query that produces 224,964,999,650,251 rows. Only 3.68ms execution time, now that&rsquo;s impressive!</p>
</blockquote>
<blockquote>
<p>Very cool. Major props for putting this out there and accepting arbitrary queries.</p>
</blockquote>
<blockquote>
<p>Very impressive, i think building your own (performant) database from scratch is one of the most impressive software engineering feats.</p>
</blockquote>
<blockquote>
<p>Very cool and impressive!! Is full PostreSQL wire compatibility on the roadmap? I like postgres compatibility :)</p>
</blockquote>
<p>(Yes, full PostgreSQL Wire Protocol is on the roadmap!)</p>
<blockquote>
<p>Mind blowing, did not know about questDB. The back button seems broken on chrome mobile</p>
</blockquote>
<p>Yes, the demo did break the Back button on your browser. There&rsquo;s an actual reason for that, but it is true, for now. We&rsquo;re definitely addressing that one right away.</p>
<h2 id="try-it-yourself">Try It Yourself</h2>
<p>Want to try it yourself? You&rsquo;ve read this far, you really should! got to <a href="http://try.questdb.io:9000/">http://try.questdb.io:9000/</a> to give it a whirl.</p>
<p>We&rsquo;d love to have you join us on our <a href="https://serieux-saucisson-79115.herokuapp.com/">Community Slack Channel</a>, give us a <a href="https://github.com/questdb/questdb">Star on GitHub</a>, and <a href="https://questdb.io/getstarted">Download</a> and try it yourself!</p>

        
        

        
        
        
        


        


        
        
        
        
        
        
          
        
        
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/davidgs/website/edit//content/posts/category/database/what-happens-when-you-put-your-sql-database-on-the-internet.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/category/iot/iot-hardware/quickly-connect-an-argon-iot-device-to-questdb/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Quickly Connect an Argon IoT Device to QuestDB</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/category/database/using-python-to-access-questdb/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Using Python to Access QuestDB</span>
          </a>
        </div>
      
    
  

  

  

  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#the-idea">The Idea</a></li>
    <li><a href="#what-it-is">What It Is</a></li>
    <li><a href="#the-hacker-news-post">The Hacker News Post</a></li>
    <li><a href="#what-happened">What Happened</a></li>
    <li><a href="#what-we-learned">What we learned</a></li>
    <li><a href="#conclusions">Conclusions</a></li>
    <li><a href="#try-it-yourself">Try It Yourself</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experience</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#education">Education</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>davidgs@davidgs.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;1 (919) 534-5099</span></li>
          
        </ul>
      </div>
      
      
      <div class="col-md-4 col-sm-12">
        
        <p>Stay up to date with email notification</p>
        <form>
          <div class="form-group">
            <input
              type="email"
              class="form-control"
              id="exampleInputEmail1"
              aria-describedby="emailHelp"
              placeholder="Enter email"
            />
            <small id="emailHelp" class="form-text text-muted"
              >We&#39;ll never share your email with anyone else.</small
            >
          </div>
          <button type="submit" class="btn btn-info">Submit</button>
        </form>
      </div>
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>



    
    
<script type="text/javascript">
  var sc_project = 4739013;
  var sc_invisible = 0;
  var sc_security = "3147012e";
  var scJsHost = "https://";
  document.write("<sc" + "ript type='text/javascript' src='" +
    scJsHost +
    "statcounter.com/counter/counter.js'></" + "script>");
</script>
<noscript>
  <div class="statcounter"><a title="Web Analytics
Made Easy - StatCounter" href="https://statcounter.com/" target="_blank"><img class="statcounter"
        src="https://c.statcounter.com/4739013/0/3147012e/0/" alt="Web Analytics Made Easy -
StatCounter"></a></div>
</noscript>

  </body>
</html>
