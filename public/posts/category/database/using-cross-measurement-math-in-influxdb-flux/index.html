<!DOCTYPE html>
<html>
  <head>
    <style>
      {
          {
           partial "debugprint.css" | safeCSS
        }
      }
    </style>
    <title>Using Cross-Measurement math in InfluxDB Flux</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu0b3af3b2695bc2a8e88d59b9721b8a18_8831_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="Using Cross-Measurement math in InfluxDB Flux" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png">David G. Simmons</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu527ca2c923a6347a00483834e2e3046d_608569_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/introduction/introduction/">Introduction</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/mad-skillz/mad-skillz/">Mad Skillz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beans/beans/">Coffee Beans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hobbies/">Hobbies</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/pranks/">Pranks</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/camunda/">Camunda</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/general/">General</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/programming/">Programming</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/dogs/">Dogs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/database/">Databases</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/category/iot/">IoT</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-hardware/">Hardware</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-software/">Software</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/work/">Work</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/devrel/">DevRel</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      
      
        
        
        
        
        






























&#34;https://davidgs.com/posts/category/database/images/Screen-Shot-2019-03-18-at-3.56.28-PM.png&#34;








        <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://davidgs.com/posts/category/database/images/Screen-Shot-2019-03-18-at-3.56.28-PM.png);'>
      </div>
      


      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/dg3.png'/>
          <h5 class="author-name">David G. Simmons</h5>
          <p>March 22, 2019</p>
        </div>

        <div class="title">
          <h1>Using Cross-Measurement math in InfluxDB Flux</h1>
        </div>

        <div class="post-content" id="post-content">


          <p>I’ve been spending a lot of time lately with the 2.0 Alpha releases and I’m here to tell you: some of the new things coming are really, really cool! Especially for IoT. The one I’ve been using lately has been the ability to do math across measurements, which is really a game-changer for IoT data in InfluxDB.</p>
<p>Let’s look at why here for a minute. As you probably know, I’ve been building out a bunch of IoT sensors that stream data to various instances of InfluxDB. One of the main sensors I use is a SenseAir K-30 CO2 sensor. It’s a fabulously accurate sensor, though it’s not cheap. I’ve been using it for a year or so and it’s extremely reliable and accurate, but I was wondering about how the temperature and the pressure might affect the CO2 readings. What I found was, of course, these things do, in fact, matter.</p>
<p>I read up on it <a href="https://www.bapihvac.com/application-note/effects-of-temperature-and-barometric-pressure-on-co2-sensors-application-note/">here</a>, but essentially the temperature and atmospheric pressure affect the amount of gas inside the measuring chamber, not the concentration, so one should compensate for that. It’s a fairly simple calculation to do using some reference values like absolute zero and the pressure at sea level.</p>
<p>We’ll use the <a href="https://en.wikipedia.org/wiki/Ideal_gas_law">Ideal Gas Law</a> formula:</p>
<pre><code>ppm CO2 corrected = ppm CO2 measured * ((Temp measured * Pressure Reference ) / (Pressure measured * Temp Reference))
</code></pre><p>Great. Easy! Almost. I have a temperature/pressure sensor that stores values in an ‘environment’ measurement in my InfluxDB instance. My CO2 sensor stores its readings in a “k30_reader” measurement. If you’re not using Flux, you already see the problem here: These values live in different measurements, so I either can’t do this calculation or I have to do a fair amount of gymnastics to somehow rewrite all these values into a common measurement first. Neither is a really viable answer, is it?</p>
<p>Enter Flux and cross-measurement maths! So let’s walk through how I accomplished this in Flux (with a <em>ton</em> of help from fellow DevRel Anais, among others). A little refresher on how Flux returns values first. Let’s remember that when I submit a query in Flux, I get back a table of values. This becomes important as we walk through how the Flux query is built, so keep that in mind.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Tref</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">298.15</span>
<span style="color:#a6e22e">Pref</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1013.25</span>

<span style="color:#a6e22e">Tmeas</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">bucket</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;telegraf&#34;</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStart</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_measurement</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;environment&#34;</span> <span style="color:#a6e22e">and</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_field</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;temp_c&#34;</span>))
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">aggregateWindow</span>(<span style="color:#a6e22e">every</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span><span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mean</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#e6db74">&#34;_time&#34;</span>])
</code></pre></div><p>First I’ve defined my reference temperature and pressure values. The reference temperature is usually 25ºC, converted to Kelvin, and the reference Pressure is sea level. I then query values of the Measured Temperature Values and store it in a table called ‘Tmeas’. If I <code>yield()</code> on this table, I’ll see my temperature values:</p>
<p><img src="/posts/category/database/images/Screen-Shot-2019-03-19-at-4.21.00-PM.png" alt=""></p>
<p>I then repeat this for the CO2 and Pressure values:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">CO2meas</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">bucket</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;telegraf&#34;</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStart</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_measurement</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;k30_reader&#34;</span> <span style="color:#a6e22e">and</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_field</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;co2&#34;</span>))
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">aggregateWindow</span>(<span style="color:#a6e22e">every</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span><span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mean</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#e6db74">&#34;_time&#34;</span>])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Pmeas</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">bucket</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;telegraf&#34;</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStart</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_measurement</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;environment&#34;</span> <span style="color:#a6e22e">and</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_field</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;pressure&#34;</span>))
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">aggregateWindow</span>(<span style="color:#a6e22e">every</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span><span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mean</span>)
   <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#e6db74">&#34;_time&#34;</span>])
</code></pre></div><p>Great! I now have 3 tables with all the values I need to do my calculations. All I have to do now is pull them all together, and I’ll do that through a series of <code>join()</code> statements:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">first_join</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">tables</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">CO2meas</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">CO2meas</span>, <span style="color:#a6e22e">Tmeas</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Tmeas</span>}, <span style="color:#a6e22e">on</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_time&#34;</span>])
    <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value_CO2meas&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value_CO2meas&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">400.00</span>)
    <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value_Tmeas&#34;</span>,<span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value_Tmeas&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">20.0</span>)
</code></pre></div><p>This first <code>join()</code> gets me a table that contains the CO2 and temperature values, so I’m part way there.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">second_join</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">tables</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">first_join</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">first_join</span>, <span style="color:#a6e22e">Pmeas</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Pmeas</span>}, <span style="color:#a6e22e">on</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_time&#34;</span>])
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1013.25</span>)
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#a6e22e">_time</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_time</span>, <span style="color:#a6e22e">_Pmeas</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_value</span>, <span style="color:#a6e22e">_CO2meas</span><span style="color:#f92672">:</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_value_CO2meas</span>, <span style="color:#a6e22e">_Tmeas</span><span style="color:#f92672">:</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_value_Tmeas</span>}))
</code></pre></div><p>This second <code>join()</code> gets me a table with all the measured values in it! You’d think I’d be done, but in order to do the final calculation, since I’m joining on <code>time</code>, I have to build a final table where I fill in the reference values for each row in the table.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">final</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">second_join</span>
   <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#a6e22e">Pmeas</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_Pmeas</span>, <span style="color:#a6e22e">CO2meas</span><span style="color:#f92672">:</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_CO2meas</span>, <span style="color:#a6e22e">Tmeas</span><span style="color:#f92672">:</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_Tmeas</span>, <span style="color:#a6e22e">Pref</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Pref</span>, <span style="color:#a6e22e">Tref</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Tref</span>, <span style="color:#a6e22e">_time</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_time</span>,}))
    <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_time&#34;</span>, <span style="color:#e6db74">&#34;CO2meas&#34;</span>, <span style="color:#e6db74">&#34;Pmeas&#34;</span>, <span style="color:#e6db74">&#34;Tmeas&#34;</span>, <span style="color:#e6db74">&#34;Pref&#34;</span>, <span style="color:#e6db74">&#34;Tref&#34;</span>])
</code></pre></div><p>So now I can create a final table and calculate the compensated CO2 value, for each row (time).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">CO2corr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">final</span>
    <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#e6db74">&#34;_time&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_time</span>, <span style="color:#e6db74">&#34;CO2-Measured&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">CO2meas</span>, <span style="color:#e6db74">&#34;CO2-Adjusted&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">CO2meas</span> <span style="color:#f92672">*</span> (((<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Tmeas</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">273.15</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Pref</span>) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Pmeas</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Tref</span>))}))
   <span style="color:#f92672">|&gt;</span> <span style="color:#66d9ef">yield</span>()
</code></pre></div><p>Since this is my final table, I call <code>yield()</code> at the end so that the values will get displayed.</p>
<p>And now I have a graph that shows the raw, measured CO2 value and the compensated CO2 value! All done on-the-fly using Flux’s cross-measurement math!</p>
<p><img src="/posts/category/database/images/Screen-Shot-2019-03-18-at-3.56.28-PM.png" alt=""></p>
<p>I&rsquo;ve actually been wanting to do this sensor compensation for a <strong>long</strong> time and I&rsquo;m thrilled that I can now do it quickly and easily using Flux! So what will you do with cross-measurement math in Flux? Feel free to tweet me your ideas, solutions, etc. <a href="https://twitter.com/davidgsIoT">@davidgsIoT</a>!</p>

        
        

        
        
        
        


        


        
        
        
        
        
        
          
        
        
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/davidgs/website/edit//content/posts/category/database/using-cross-measurement-math-in-influxdb-flux.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/category/database/publishing-data-to-influxdb-from-swift/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Publishing Data to InfluxDB from Swift</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/category/database/writing-to-influxdb-2-0-from-arduino-esp8266/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Writing to InfluxDB 2.0 from Arduino ESP8266</span>
          </a>
        </div>
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents"></nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experience</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#education">Education</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>davidgs@davidgs.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;1 (919) 534-5099</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>



    
    
<script type="text/javascript">
  var sc_project = 4739013;
  var sc_invisible = 0;
  var sc_security = "3147012e";
  var scJsHost = "https://";
  document.write("<sc" + "ript type='text/javascript' src='" +
    scJsHost +
    "statcounter.com/counter/counter.js'></" + "script>");
</script>
<noscript>
  <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
        class="statcounter" src="https://c.statcounter.com/4739013/0/3147012e/0/" alt="Web Analytics"></a></div>
</noscript>

  </body>
</html>
