<!DOCTYPE html>
<html>
  <head>
    <style>
      {
          {
           partial "debugprint.css" | safeCSS
        }
      }
    </style>
    <title>Hiding Complexity with Custom Functions Calculating Heat Index</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu0b3af3b2695bc2a8e88d59b9721b8a18_8831_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="Hiding Complexity with Custom Functions Calculating Heat Index" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png">David G. Simmons</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu36e4c6c516043df4c5aad6d68b952eee_646582_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu527ca2c923a6347a00483834e2e3046d_608569_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
  
    
    <li><a class="" href="/posts/introduction/introduction/">Introduction</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/mad-skillz/mad-skillz/">Mad Skillz</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/beans/beans/">Coffee Beans</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/hobbies/">Hobbies</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/pranks/">Pranks</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/camunda/">Camunda</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/general/">General</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/programming/">Programming</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/dogs/">Dogs</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/database/">Databases</a></li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/category/iot/">IoT</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-hardware/">Hardware</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/iot/iot-software/">Software</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/work/">Work</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/category/devrel/">DevRel</a></li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      
      
        
        
        
        
        






























&#34;https://davidgs.com/posts/category/programming/images/HeatIndex.png&#34;








        <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://davidgs.com/posts/category/programming/images/HeatIndex.png);'>
      </div>
      


      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/author/dg3.png'/>
          <h5 class="author-name">David G. Simmons</h5>
          <p>August 23, 2019</p>
        </div>

        <div class="title">
          <h1>Hiding Complexity with Custom Functions Calculating Heat Index</h1>
        </div>

        <div class="post-content" id="post-content">


          <p>Have you ever watched the local weather — or The Weather Channel — and heard them announce the temperature, and then the &ldquo;Heat Index&rdquo;? Or how hot it <strong>feels</strong> outside? At least here in the United States, and especially in the South, it&rsquo;s part of every weather broadcast in the summer. But have you ever wondered how they actually <em>calculate</em> the Heat Index? Since I collect temperature and humidity data, I decided one day I&rsquo;d go and figure it out. After all, how hard could it be really? Hint: never ask yourself that question!</p>
<h2 id="the-heat-index-calculation">The Heat Index calculation</h2>
<p>As soon as I went looking for what I was sure was a simple calculation to convert a temperature and a humidity reading into a heat index (HI) I was sorry I&rsquo;d headed down this road. I easily found a page where the National Oceanic and Atmospheric Administration (NOAA) lays out the formula. It&rsquo;s something called the Rothfusz Regression equation, and it goes like this:</p>
<p><strong>HI = -42.379 + 2.04901523<em>T + 10.14333127</em>RH - .22475541<em>T</em>RH - .00683783<em>T</em>T - .05481717<em>RH</em>RH + .00122874<em>T</em>T<em>RH + .00085282</em>T<em>RH</em>RH - .00000199<em>T</em>T<em>RH</em>RH</strong></p>
<p>Where <strong>T</strong> is temperature and <strong>RH</strong> is relative humidity. Simple, right? Not so fast! It turns out there are a bunch of caveats to that (simple) equation. For instance, if the relative humidity is less than 13% and the temperature is between 80ºF and 112ºF, then you have to adjust the heat index by subtracting the following <strong>Adjustment</strong> from it:</p>
<p>*<em>ADJUSTMENT = [(13-RH)/4]<em>SQRT{[17-ABS(T-95.)]/17}</em></em></p>
<p>Ok, fine. But wait, there&rsquo;s more! If the relative humidity is above 85%, and the temperature is between 80ºF and 112ºF, then you need to <strong>add</strong> the following <strong>Adjustment</strong> to it:</p>
<p><strong>ADJUSTMENT = [(RH-85)/10] / [(87-T)/5]</strong></p>
<p>Outstanding! We&rsquo;re finally there &hellip; wait, no we&rsquo;re not there yet. If the heat index is below 80ºF, then you don&rsquo;t need to use that calculation to determine the heat index. You can use a more simple Steadman equation:</p>
<p><strong>HI = 0.5 / {T + 61.0 + [(T-68.0)<em>1.2] + (RH</em>0.094)}</strong></p>
<p>So first you calculate the heat index using that &lsquo;simple&rsquo; equation &ndash; and, according to NOAA, you average that with the temperature reading. If that is less than 80ºF, you have your answer. If not, you need to proceed with the Rothfusz regression and add (or subtract) any adjustments, if required.</p>
<p>See? Simple, really.</p>
<h2 id="doing-it-in-flux">Doing it in Flux</h2>
<p>Here&rsquo;s where some complicated Flux comes into play. You see, my temperature and humidity readings are in different measurements, so first there&rsquo;s the task of building the tables, and joining them (yay for the beauty of cross-measurement math in Flux!).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">humidity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">bucket</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;telegraf&#34;</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStart</span>, <span style="color:#a6e22e">stop</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStop</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_measurement</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;environment&#34;</span> <span style="color:#a6e22e">and</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_field</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;humidity&#34;</span>))
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">aggregateWindow</span>(<span style="color:#a6e22e">every</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span><span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mean</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#e6db74">&#34;_time&#34;</span>])

<span style="color:#a6e22e">temperature</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">bucket</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;telegraf&#34;</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">start</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">timeRangeStart</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_measurement</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;temperature&#34;</span> <span style="color:#a6e22e">and</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_field</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;temp_f&#34;</span>))
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">aggregateWindow</span>(<span style="color:#a6e22e">every</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">30</span><span style="color:#a6e22e">s</span>, <span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mean</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">fill</span>(<span style="color:#a6e22e">column</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#a6e22e">usePrevious</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>)
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_value&#34;</span>, <span style="color:#e6db74">&#34;_time&#34;</span>])
  <span style="color:#f92672">|&gt;</span> <span style="color:#66d9ef">yield</span>(<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Temperature&#34;</span>)
</code></pre></div><p>That gets me my 2 tables of values. (Side note: I yield the Temperature table so that my graph will show both the temperature and the heat index on the same graph.)</p>
<p>Next, I join the 2 tables:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">first_join</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">join</span>(<span style="color:#a6e22e">tables</span><span style="color:#f92672">:</span> {<span style="color:#a6e22e">temperature</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">temperature</span>, <span style="color:#a6e22e">humidity</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">humidity</span>}, <span style="color:#a6e22e">on</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_time&#34;</span>])
  <span style="color:#f92672">|&gt;</span><span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#a6e22e">temperature</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_value_temperature</span>, <span style="color:#a6e22e">humidity</span><span style="color:#f92672">:</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_value_humidity</span>, <span style="color:#a6e22e">_time</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_time</span>}))
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">keep</span>(<span style="color:#a6e22e">columns</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;_time&#34;</span>, <span style="color:#e6db74">&#34;humidity&#34;</span>, <span style="color:#e6db74">&#34;temperature&#34;</span>])
</code></pre></div><p>So now I have a single table, aligned on time, with columns for <code>temperature</code> and <code>humidity</code>. All that&rsquo;s left is to do the calculation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#a6e22e">t</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">temperature</span>, <span style="color:#a6e22e">h</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">humidity</span>}))
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({
     <span style="color:#a6e22e">r</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">heatIndex</span><span style="color:#f92672">:</span>
       <span style="color:#66d9ef">if</span> ((<span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">61.0</span> <span style="color:#f92672">+</span> ((<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">-</span><span style="color:#ae81ff">68.0</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.2</span>) <span style="color:#f92672">+</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0.094</span>)))<span style="color:#f92672">/</span><span style="color:#ae81ff">2.0</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">80.0</span> <span style="color:#a6e22e">then</span> (<span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">61.0</span> <span style="color:#f92672">+</span> ((<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">68.0</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.2</span>) <span style="color:#f92672">+</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0.094</span>)))
       <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">13.0</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">80.0</span>) <span style="color:#a6e22e">then</span> ((<span style="color:#f92672">-</span><span style="color:#ae81ff">42.379</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.04901523</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10.14333127</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.22475541</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00683783</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.05481717</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00122874</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00085282</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00000199</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> (((<span style="color:#ae81ff">13.0</span><span style="color:#f92672">-</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">4.0</span>)<span style="color:#f92672">*</span><span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> ((<span style="color:#ae81ff">17.0</span><span style="color:#f92672">-</span><span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">x</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">-</span><span style="color:#ae81ff">95.0</span>))<span style="color:#f92672">/</span><span style="color:#ae81ff">17.0</span>))))))
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">85.0</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">80.0</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">87.0</span> <span style="color:#a6e22e">then</span> ((<span style="color:#f92672">-</span><span style="color:#ae81ff">42.379</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.04901523</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10.14333127</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.22475541</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00683783</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.05481717</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00122874</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00085282</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00000199</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span>) <span style="color:#f92672">+</span> (( <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">-</span><span style="color:#ae81ff">85.0</span> )<span style="color:#f92672">/</span><span style="color:#ae81ff">10.0</span>) <span style="color:#f92672">*</span>((<span style="color:#ae81ff">87.0</span><span style="color:#f92672">-</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">5.0</span>))
        <span style="color:#66d9ef">else</span> (<span style="color:#f92672">-</span><span style="color:#ae81ff">42.379</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.04901523</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">10.14333127</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.22475541</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00683783</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.05481717</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00122874</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">.00085282</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">.00000199</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">t</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span><span style="color:#f92672">*</span><span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">h</span>)
      })
  )
  <span style="color:#f92672">|&gt;</span> <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">fn</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span>) =&gt; ({<span style="color:#a6e22e">_value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">heatIndex</span>, <span style="color:#a6e22e">_time</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">_time</span>}))
  <span style="color:#f92672">|&gt;</span> <span style="color:#66d9ef">yield</span>(<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;HeatIndex&#34;</span>)
</code></pre></div><p>I told you it was complicated Flux!</p>
<p>But in the end, you can then have a graph that shows the actual temperature and the calculated Heat Index in the same table cell:</p>
<p><img src="/posts/category/programming/images/HeatIndex.png" alt="Heat Index">And that&rsquo;s a pretty cool thing!</p>
<h2 id="next-step">Next step</h2>
<p>Since that&rsquo;s a lot of complicated Flux. The next step is to pull that all into Flux functions so that you can simply call <code>|&gt; HeatIndex()</code> on your table with <code>temperature</code> and <code>humidity</code> columns and get back the proper table with the resulting heat indexes all calculated for you. So I&rsquo;m in the process of adding the <code>HeatIndex()</code> function to Flux so you can have pretty Flux when you calculate your heat indexes.</p>
<p>I&rsquo;m planning to add in the calculation for Ideal Gas Law (an easy one) and Wind Chill as well (another ugly one!) to this future package as well as converters from ºF to ºC, so if you have any other ideas for things that you would use for environmental calculations, please <a href="https://twitter.com/intent/follow?screen_name=davidgsIoT">reach out</a> and let me know!</p>

        
        

        
        
        
        


        


        
        
        
        
        
        
          
        
        
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/davidgs/website/edit//content/posts/category/programming/hiding-complexity-with-custom-functions-calculating-heat-index.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/category/iot/sensing-with-the-things-network/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Sensing with The Things Network</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/category/database/how-to-output-data-from-flux-to-mqtt-natively/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>How to Output Data from Flux to MQTT Natively</span>
          </a>
        </div>
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</div>

      <hr />
      
      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#the-heat-index-calculation">The Heat Index calculation</a></li>
    <li><a href="#doing-it-in-flux">Doing it in Flux</a></li>
    <li><a href="#next-step">Next step</a></li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experience</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#education">Education</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>davidgs@davidgs.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;1 (919) 534-5099</span></li>
          
        </ul>
      </div>
      
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>



    
    
<script type="text/javascript">
  var sc_project = 4739013;
  var sc_invisible = 0;
  var sc_security = "3147012e";
  var scJsHost = "https://";
  document.write("<sc" + "ript type='text/javascript' src='" +
    scJsHost +
    "statcounter.com/counter/counter.js'></" + "script>");
</script>
<noscript>
  <div class="statcounter"><a title="Web Analytics" href="https://statcounter.com/" target="_blank"><img
        class="statcounter" src="https://c.statcounter.com/4739013/0/3147012e/0/" alt="Web Analytics"></a></div>
</noscript>

  </body>
</html>
